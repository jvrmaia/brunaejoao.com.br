var RsvpView=null;!function(e){RsvpView=BaseBackboneView.extend({initialize:function(){this.constructor.__super__.initialize.call(this);var t=this;this.adopted=!0;var o=e(".template-rsvp");if(o.get(0))this.setElement(o),t.options.onload&&t.options.onload.call(t);else{var n=null;this.adopted=!1,render_template("template_rsvp_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/rsvp/"+this.options.noivos.get("template_html_version")+"/index",{noivos:this.options.noivos.attributes,rsvp_config:this.options.rsvp_config.attributes,pagina:this.options.pagina.attributes,convidado:n},function(e){t.setElement(e),t.options.onload&&t.options.onload.call(t)})}},change_pessoas:function(t){var o=e("#rsvp select[name='adultos'] option:selected").val();if(""!=o){try{o=parseInt(o)}catch(n){o=0}1==o?e("#mensagem").attr("ignore","true"):e("#mensagem").removeAttr("ignore")}},save_rsvp:function(){var t=this,o=e("#rsvp input[name='nome']").val(),n=e("#rsvp input[name='evento']:checked").val(),a=e("#rsvp select[name='adultos'] option:selected").val(),i=e("#rsvp select[name='criancas'] option:selected").val(),s=e("#rsvp input[name='email']").val(),r=e("#rsvp input[name='ddd']").val(),l=e("#rsvp input[name='telefone']").val(),c=e("#rsvp textarea[name='mensagem']").val(),d=0;t.options.convidado&&(d=t.options.convidado.get("id_convidado"));var u=new TemplateRsvp;window.loading.jLoading("block",!0),u.save({id_noivo:t.options.noivos.get("id_noivo"),nome:o,evento:n,qtd_pessoas:a,criancas:i,convidado:"noiva",email:s,ddd:r,telefone:l,acompanhantes:c,id_convidado:d},{wait:!0,success:function(){window.loading.jLoading("block",!1),t.options.convidado=null;render_template("template_rsvp_id","/templates/backbone/"+t.options.noivos.get("id_noivo")+"/rsvp/"+t.options.noivos.get("template_html_version")+"/index",{noivos:t.options.noivos.attributes,rsvp_config:t.options.rsvp_config.attributes,pagina:t.options.pagina.attributes,convidado:null},function(o){t.setElement(o),change_content(o,function(){t.render(),e(".def-result-message").addClass("success").removeClass("error"),e(".def-result-message").html(I18n.t("rsvp.messages.success.success")),e(".def-result-message").show()},{template:"front",noivos:t.options.noivos})})},error:function(t,o,n){window.loading.jLoading("block",!1);var a=o.responseText,i=JSON.parse(a);for(var s in i.errors){var r=i.errors[s];e("#rsvp").formhelper("flagerror",r.key,r.value)}e(".def-result-message").addClass("error").removeClass("success"),e(".def-result-message").html(I18n.t("formhelper.formhelper_invalid_values")),e(".def-result-message").show()}})},render:function(){var t=this;return load_css("//assets1.icasei.com.br/assets/formhelper.css"),load_js("//assets1.icasei.com.br/assets/formhelper.js",function(){e("#rsvp").formhelper({defaultField:"nome",autoRender:!1,messages:form_helper_messages,onChangeCompleted:function(o){"adultos"==e(o).attr("id")&&t.change_pessoas()},onSubmitError:function(){e(".def-result-message").addClass("error").removeClass("success"),e(".def-result-message").html(I18n.t("formhelper.formhelper_invalid_values")),e(".def-result-message").show(),e("html,body").animate({scrollTop:0},200)},onSubmit:function(){if(1!=t.options.rsvp_config.get("aberto")||t.options.convidado)t.save_rsvp();else{var o=e("#nome").val(),n=new TemplateRsvpConvidado;window.loading.jLoading("block",!0),n.fetch({data:{id_noivo:t.options.noivos.get("id_noivo"),nome:o},success:function(){if(window.loading.jLoading("block",!1),n.get("error"))e(".def-result-message").addClass("error").removeClass("success"),e(".def-result-message").html(I18n.t("rsvp.messages.error.not_found")),e(".def-result-message").show(),e("html,body").animate({scrollTop:0},200);else if(e(".def-result-message").hide(),t.options.convidado=n,t.options.convidado){var o=new EJS({url:"/templates/backbone/"+t.options.noivos.get("id_noivo")+"/rsvp/"+t.options.noivos.get("template_html_version")+"/index"}).render({noivos:t.options.noivos.attributes,rsvp_config:t.options.rsvp_config.attributes,pagina:t.options.pagina.attributes,convidado:t.options.convidado.attributes});t.setElement(o),change_content(o,function(){t.render()},{template:"front",noivos:t.options.noivos})}},error:function(){window.loading.jLoading("block",!1),e(".def-result-message").addClass("error").removeClass("success"),e(".def-result-message").html(I18n.t("rsvp.messages.error.error")),e(".def-result-message").show(),e("html,body").animate({scrollTop:0},200)}})}return!1}}),e("#rsvp").formhelper("init"),t.change_pessoas()}),this}})}(jQuery);