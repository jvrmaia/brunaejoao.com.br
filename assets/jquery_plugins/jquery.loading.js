function jLoading(e,t){this.options=jQuery.extend({},jLoading.DEFAULTS,t||{}),this.element=e}jQuery.fn.jLoading=function(e,t){return e=e||{},"string"!=typeof e?this.each(function(t,o){o.loading=new jLoading(jQuery(o),e),o.loading.init()}):this.each(function(o,a){"start"==e?a.loading._start():"stop"==e?a.loading._stop():"ignore"==e?a.loading._ignore(t):"block"==e?a.loading.block=t:"abortAllConnections"==e&&a.loading._abortAllConnections()}),this},jLoading.prototype._ignore=function(e){e?this.element.attr("ignore","true"):this.element.removeAttr("ignore")},jLoading.prototype._abortAllConnections=function(){if(this.ajaxPool){for(var e=0;e<this.ajaxPool.length;e++){var t=this.ajaxPool[e];t.abort()}this.ajaxPool=[],this.global_element.hide().find(".global-loading-progress").stop(!0,!0),this.global_element.find(".global-loading-progress").css({width:0})}},jLoading.prototype._start=function(){if("true"!=this.element.attr("ignore")){var e=this;if(e.count<=0&&(e.started_block=e.block,e.count=0),1==e.started_block){if(!$(e.element).is(":visible")){var t=$(e.element).width(),o=$(e.element).height(),a=$(window).height(),n=$(window).width();$(e.element).css("left",n/2-t/2+"px"),$(e.element).css("top",a/2-o/2+"px"),$(e.element).show(),e.block_page=$('<div id="block_page"></div>');$(document).height(),$(window).width();e.block_page.css("height",a),e.block_page.css("width",n),$("body").append(e.block_page)}}else e.global_element.find(".global-loading-progress").css({width:0}),e.global_element.show().find(".global-loading-progress").animate({width:$(window).width()/2},1e3)}},jLoading.prototype._stop=function(){if("true"!=this.element.attr("ignore")){var e=this;e.count<=0&&(e.count=0),1==this.started_block?e.count<=0&&($(e.element).hide(),e.block_page&&(e.block_page.remove(),e.block_page=null)):e.global_element.find(".global-loading-progress").animate({width:$(window).width()},1e3,function(){e.global_element.hide().find(".global-loading-progress").css({width:0})})}},jLoading.prototype.array_search=function(e,t,o){for(var a=o||0;a<e.length;a++)if(e[a]==t)return a;return-1},jLoading.prototype.init=function(){var e=this;this.count=0,this.ajaxPool=[],this.global_element=$('<div class="global-loading"><div class="global-loading-progress"></div></div>'),this.global_element.find(".global-loading-progress").css({width:0,height:e.options.global_height}),$(window).on("resize",function(){e.global_element.hide().css({width:$(window).width(),height:e.options.global_height})}).trigger("resize"),$("body").append(this.global_element),this.block=this.options.block,$(document).ajaxStart(function(){e._start()}),$(document).ajaxStop(function(){e._stop()}),$.ajaxSetup({beforeSend:function(t){e.ajaxPool.push(t),e.count++},complete:function(t){var o=-1;try{o=Array.prototype.indexOf?e.ajaxPool.indexOf(t):e.array_search(e.ajaxPool,t)}catch(a){}o>-1&&e.ajaxPool.splice(o,1),e.count--}})},jQuery.extend(jLoading,{DEFAULTS:{block:!1,global_height:"3px"}});