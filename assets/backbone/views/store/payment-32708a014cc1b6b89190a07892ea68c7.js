var PaymentView=null;!function(e){PaymentView=BaseBackboneView.extend({events:{"click label[name='paymentMethod']":"payment_click","click .def-payment":"submit_payment_click"},submit_payment_click:function(t){e(t.currentTarget).removeClass("def-payment").addClass("def-payment-true"),e("#pagamento").formhelper("submit",e(t.currentTarget),!0)},payment_click:function(t){var o=e("input:radio",t.currentTarget);switch(o.attr("name")){case"paymentMethod":if(o.is(":checked")){e(".payment-active").removeClass("payment-active"),o.parents("label").addClass("payment-active");var n=o.val();switch(n){case"deposito":e(".payment-deposito").show(),e(".payment-boleto").hide(),e(".payment-card").hide(),this.emptyFields(n),e("input[name*='instalments']").attr("ignore","true"),e("#ccNumber").attr("ignore","true"),e("#ccName").attr("ignore","true"),e("#ccValidityMonth").attr("ignore","true"),e("#ccValidityYear").attr("ignore","true"),e("#ccSecurityCode").attr("ignore","true"),e("input[name='instalments_"+n+"']").attr("ignore","true");break;case"boleto":e(".payment-boleto").show(),e(".payment-deposito").hide(),e(".payment-card").hide(),this.emptyFields(n),e("input[name*='instalments']").attr("ignore","true"),e("#ccNumber").attr("ignore","true"),e("#ccName").attr("ignore","true"),e("#ccValidityMonth").attr("ignore","true"),e("#ccValidityYear").attr("ignore","true"),e("#ccSecurityCode").attr("ignore","true"),e("input[name='instalments_"+n+"']").attr("ignore","true");break;default:this.setMask(n),this.emptyFields(n),e(".payment-boleto").hide(),e(".payment-deposito").hide(),e(".payment-card").show(),e(".dados-radio-right > div").hide(),e(".taxas-parcelas-"+n).show(),e("."+n+"1").after(e(".payment-card")),"amex"==n?(e(".tooltipamex").show(),e(".tooltipdefault").hide()):(e(".tooltipamex").hide(),e(".tooltipdefault").show()),e("input[name*='instalments']").attr("ignore","true"),e("#ccNumber").removeAttr("ignore"),e("#ccName").removeAttr("ignore"),e("#ccValidityMonth").removeAttr("ignore"),e("#ccValidityYear").removeAttr("ignore"),e("#ccSecurityCode").removeAttr("ignore"),e("input[name='instalments_"+n+"']").removeAttr("ignore")}}else o.parents("label").removeClass("payment-active");break;case"ccName":break;case"ccValidityMonth":break;case"ccValidityYear":break;case"instalments":}},emptyFields:function(t){e("#pagamento").formhelper("setvalue","ccNumber","",!1),e("#pagamento").formhelper("setvalue","ccName","",!1),e("#pagamento").formhelper("setvalue","ccValidityMonth","",!1),e("#pagamento").formhelper("setvalue","ccValidityYear","",!1),e("#pagamento").formhelper("setvalue","ccSecurityCode","",!1),e("#pagamento").formhelper("setvalue","instalments_"+t,1,!1),e("#instalments_error").addClass("inpt-label-info").html(I18n.t("store.payment.errors.installments")),e(".chzn-single.chzn-default span").html("")},setMask:function(t){e("#ccNumber").attr("association",t),e("#ccSecurityCode").attr("association",t);var o="9999 9999 9999 9999",n="999";"amex"==t&&(o="9999 999999 99999",n="9999"),e("#ccNumber").mask(o),e("#ccSecurityCode").mask(n)},initialize:function(){this.constructor.__super__.initialize.call(this);var t=this;this.adopted=!0;var o=e(".template-payment");o.get(0)?(this.setElement(o),t.options.onload&&t.options.onload.call(t)):(this.adopted=!1,render_template("template_payment_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/store/"+this.options.noivos.get("template_html_version")+"/payment",{noivos:this.options.noivos.attributes,cart:this.options.cart.attributes,loja_dado:this.options.loja_dado.attributes,tipos_pagamentos:this.options.tipos_pagamentos.models[0].get("tipos_pagamentos"),taxas_pagamentos:this.options.tipos_pagamentos.models[0].get("taxas_pagamentos")},function(e){t.setElement(e),t.options.onload&&t.options.onload.call(t)}))},render:function(){var t=this;return e(".tTipT").tipTip({defaultPosition:"top"}),e(".tTipR").tipTip({defaultPosition:"right"}),load_css("//assets1.icasei.com.br/assets/formhelper.css"),load_js("//assets1.icasei.com.br/assets/formhelper.js",function(){e("#pagamento").formhelper({defaultField:"nome",autoRender:!1,messages:form_helper_messages,onSubmitError:function(){0!=e(".def-payment-true").length&&e(".def-payment-true").addClass("def-payment").removeClass("def-payment-true"),Boxy.alert(I18n.t("formhelper.formhelper_invalid_values"),function(){e("html,body").animate({scrollTop:0},200)},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")})},onSubmit:function(){window.loading.jLoading("block",!0);var o=e("#pagamento input[name='paymentMethod']:checked").val(),n=e("#ccNumber").val(),a=e("#ccName").val(),i=e("#ccValidityMonth").val(),s=e("#ccValidityYear").val(),r=e("#ccSecurityCode").val(),l=e("#pagamento input[name*='instalments']:checked").val(),c={tipo_pagamento:o,cc_number:n,cc_name:a,ccValidityMonth:i,ccValidityYear:s,ccSecurityCode:r,instalments:l},d=jQuery.param(c);return jQuery.ajax({url:"/"+t.options.noivos.get("login")+"/store/do_payment",data:d,dataType:"json",type:"POST",timeout:12e5,success:function(o,n){window.loading.jLoading("block",!1),1==o.code?Backbone.history.navigate("/"+t.options.noivos.get("login")+"/store/confirm",!0):Boxy.alert(o.message,null,{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")}),0!=e(".def-payment-true").length&&e(".def-payment-true").addClass("def-payment").removeClass("def-payment-true")},error:function(t,o,n){window.loading.jLoading("block",!1),Boxy.alert(I18n.t("store.payment.errors.payment"),null,{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")}),0!=e(".def-payment-true").length&&e(".def-payment-true").addClass("def-payment").removeClass("def-payment-true")}}),!1}}),e("#pagamento").formhelper("init")}),e("div.cart-link").hide(),this}})}(jQuery);