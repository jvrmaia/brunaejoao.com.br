var StoreView=null;!function(e){StoreView=BaseBackboneView.extend({events:{"click .price-ascend":"price_ascend","click .price-descend":"price_descend","change #select_categorias":"categoria_change","click .add_cart":"add_cart"},redirect:function(e){Backbone.history.navigate("/"+this.options.noivos.get("login")+"/store/cart",!0),e.off("change")},add_cart:function(t){var o=this;e(t.currentTarget).removeClass("add_cart");var n=e(t.currentTarget).attr("productid"),a=new Cart;a.on("change",this.redirect,this),a.save({id_noivo:o.options.noivos.get("id_noivo"),id_loja_produtos:n,id_loja_sel:o.options.info.id_loja_sel},{wait:!0,error:function(e,t,o){msg=I18n.t("store.error_add"),"true"==get_meta("CD")&&(msg="Loja desativada"),Boxy.alert(msg,function(){},{title:I18n.t("layout.boxy.error_title"),closeText:I18n.t("layout.boxy.close")})}})},initialize:function(){this.constructor.__super__.initialize.call(this);var t=this;this.adopted=!0,this.options.produtos.on("change",this.redraw,this);var o=e(".template-store");o.get(0)?(this.setElement(o),t.options.onload&&t.options.onload.call(t)):(this.adopted=!1,render_template("template_store_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/store/"+this.options.noivos.get("template_html_version")+"/index",{noivos:this.options.noivos.attributes,pagina:this.options.pagina.attributes,produtos:this.options.produtos.toJSON(),loja_dados:this.options.loja_dados.attributes,categorias:this.options.categorias.toJSON(),info:this.options.info,only_products:!1,cart:this.options.cart.attributes},function(e){t.setElement(e),t.options.onload&&t.options.onload.call(t)}))},redraw:function(){var t=this;render_template("template_store_id","/templates/backbone/"+this.options.noivos.get("id_noivo")+"/store/"+this.options.noivos.get("template_html_version")+"/index",{noivos:this.options.noivos.attributes,pagina:this.options.pagina.attributes,produtos:this.options.produtos.toJSON(),loja_dados:this.options.loja_dados.attributes,categorias:this.options.categorias.toJSON(),info:this.options.info,only_products:!0,cart:this.options.cart.attributes},function(o){var n={};n=e("#list-loja").length>0?{noivos:t.options.noivos,container:"#list-loja",no_scroll:!0,destroy_view:!1}:{noivos:t.options.noivos,container:"#list-loja-v2",no_scroll:!0,destroy_view:!1},change_content(o,function(){e(document).trigger("icasei_content_change")},n)})},render:function(){if(load_css("//assets1.icasei.com.br/assets/formhelper.css"),load_js("//assets1.icasei.com.br/assets/formhelper.js",function(){e(".sort-select select").chosen()}),this.options.cart.has("products")&&this.options.cart.get("products").length>0){var t=I18n.t("store.cart_item");this.options.cart.get("products").length>1&&(t=I18n.t("store.cart_items")),e("span.cart-items-label").html(t),e("span.cart-items").html(this.options.cart.get("products").length),e("div.cart-link").show()}else e("div.cart-link").hide();return this},categoria_change:function(){6==this.options.info.order?this.price_ascend():this.price_descend()},price_ascend:function(){var t=this,o=this.options.produtos;try{t.options.info.id_loja_categoria=parseInt(e("#select_categorias").val())}catch(n){t.options.info.id_loja_categoria=-2}o.fetch({data:{id_noivo:this.options.noivos.get("id_noivo"),id:this.options.pagina.get("recurso").id_tipo_loja,order:6,id_loja_categoria:t.options.info.id_loja_categoria,id_loja:this.options.info.id_loja_sel},success:function(){o.trigger("change"),e(".price-ascend").addClass("active"),e(".price-descend").removeClass("active"),t.options.info.order=6},error:function(){}})},price_descend:function(){var t=this,o=this.options.produtos;try{t.options.info.id_loja_categoria=parseInt(e("#select_categorias").val())}catch(n){t.options.info.id_loja_categoria=-2}o.fetch({data:{id_noivo:this.options.noivos.get("id_noivo"),id:this.options.pagina.get("recurso").id_tipo_loja,order:5,id_loja_categoria:t.options.info.id_loja_categoria,id_loja:this.options.info.id_loja_sel},success:function(){o.trigger("change"),e(".price-ascend").removeClass("active"),e(".price-descend").addClass("active"),t.options.info.order=5},error:function(){}})}})}(jQuery);