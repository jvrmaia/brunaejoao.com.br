!function(e){var t=(e("body").is(".ie *")?"paste":"input")+".mask",o=void 0!=window.orientation;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]",b:"[A-Z0-9]"},dataName:"rawMaskFn"},e.fn.extend({caret:function(e,t){if(0!=this.length){if("number"==typeof e)return t="number"==typeof t?t:e,this.each(function(){if(this.setSelectionRange)this.setSelectionRange(e,t);else if(this.createTextRange){var o=this.createTextRange();o.collapse(!0),o.moveEnd("character",t),o.moveStart("character",e),o.select()}});if(this[0].setSelectionRange)e=this[0].selectionStart,t=this[0].selectionEnd;else if(document.selection&&document.selection.createRange){var o=document.selection.createRange();e=0-o.duplicate().moveStart("character",-1e5),t=e+o.text.length}return{begin:e,end:t}}},unmask:function(){return this.trigger("unmask")},mask:function(i,a){if(!i&&this.length>0){var n=e(this[0]);return n.data(e.mask.dataName)()}a=e.extend({placeholder:"_",completed:null},a);var s=e.mask.definitions,r=[],l=i.length,c=null,d=i.length;return e.each(i.split(""),function(e,t){"?"==t?(d--,l=e):s[t]?(r.push(new RegExp(s[t])),null==c&&(c=r.length-1)):r.push(null)}),this.trigger("unmask").each(function(){function n(e){for(;++e<=d&&!r[e];);return e}function u(e){for(;--e>=0&&!r[e];);return e}function p(e,t){if(!(0>e)){for(var o=e,i=n(t);d>o;o++)if(r[o]){if(!(d>i&&r[o].test(y[i])))break;y[o]=y[i],y[i]=a.placeholder,i=n(i)}g(),b.caret(Math.max(c,e))}}function h(e){for(var t=e,o=a.placeholder;d>t;t++)if(r[t]){var i=n(t),s=y[t];if(y[t]=o,!(d>i&&r[i].test(s)))break;o=s}}function m(e){var t=e.which;if(8==t||46==t||o&&127==t){var i=b.caret(),a=i.begin,s=i.end;return s-a==0&&(a=46!=t?u(a):s=n(a-1),s=46==t?n(s):s),_(a,s),p(a,s-1),!1}return 27==t?(b.val(w),b.caret(0,v()),!1):void 0}function f(e){var t=e.which,o=b.caret();if(e.ctrlKey||e.altKey||e.metaKey||32>t)return!0;if(t){o.end-o.begin!=0&&(_(o.begin,o.end),p(o.begin,o.end-1));var i=n(o.begin-1);if(d>i){var s=String.fromCharCode(t);if(b.attr("upcase")&&"true"==b.attr("upcase").toLowerCase()&&(s=s.toUpperCase()),r[i].test(s)){h(i),y[i]=s,g();var l=n(i);b.caret(l),a.completed&&l>=d&&a.completed.call(b)}}return!1}}function _(e,t){for(var o=e;t>o&&d>o;o++)r[o]&&(y[o]=a.placeholder)}function g(){return b.val(y.join("")).val()}function v(e){for(var t=b.val(),o=-1,i=0,n=0;d>i;i++)if(r[i]){for(y[i]=a.placeholder;n++<t.length;){var s=t.charAt(n-1);if(r[i].test(s)){y[i]=s,o=i;break}}if(n>t.length)break}else y[i]==t.charAt(n)&&i!=l&&(n++,o=i);return!e&&l>o+1?(b.val(""),_(0,d)):(e||o+1>=l)&&(g(),e||b.val(b.val().substring(0,o+1))),l?i:c}var b=e(this),y=e.map(i.split(""),function(e,t){return"?"!=e?s[e]?a.placeholder:e:void 0}),w=b.val();b.data(e.mask.dataName,function(){return e.map(y,function(e,t){return r[t]&&e!=a.placeholder?e:null}).join("")}),b.attr("readonly")||b.one("unmask",function(){b.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){w=b.val();var t=v();g();var o=function(){t==i.length?b.caret(0,t):b.caret(t)};(e("body").is(".ie *")?o:function(){setTimeout(o,0)})()}).bind("blur.mask",function(){v()}).bind("keydown.mask",m).bind("keypress.mask",f).bind(t,function(){setTimeout(function(){b.caret(v(!0))},0)}),v()})}})}(jQuery);